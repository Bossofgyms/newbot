import asyncio
import logging
import os
import re
from aiogram import Bot, Dispatcher, types, F
from aiogram.filters import CommandStart, Command
from aiogram.fsm.state import State, StatesGroup
from aiogram.fsm.context import FSMContext
from aiogram.types import InlineKeyboardButton, InlineKeyboardMarkup
from dotenv import load_dotenv

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env —Ñ–∞–π–ª–∞
load_dotenv()

# –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
BOT_TOKEN = os.getenv("BOT_TOKEN")

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–¥–∞–Ω –ª–∏ —Ç–æ–∫–µ–Ω
if not BOT_TOKEN:
    raise ValueError("‚ùå –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è BOT_TOKEN –Ω–µ –∑–∞–¥–∞–Ω–∞! –ü—Ä–æ–≤–µ—Ä—å —Ñ–∞–π–ª .env")

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–æ–¥—É–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞
from database import init_db, save_user, update_user_data, subscribe_user, unsubscribe_user, get_user_data
from zodiac import get_zodiac_sign
from horoscope_api import get_daily_horoscope, get_natal_chart_info
from scheduler import scheduler

# –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
logging.basicConfig(level=logging.INFO)

# –°–æ–∑–¥–∞—ë–º —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –±–æ—Ç–∞ –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞
bot = Bot(token=BOT_TOKEN)
dp = Dispatcher()

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è FSM
class UserData(StatesGroup):
    waiting_for_birth_date = State()
    waiting_for_birth_time = State()
    waiting_for_birth_place = State()

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Å –∫–Ω–æ–ø–∫–∞–º–∏
def get_main_keyboard():
    """–°–æ–∑–¥–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Å –∫–Ω–æ–ø–∫–∞–º–∏"""
    keyboard = [
        [types.KeyboardButton(text="üîÆ –ì–æ—Ä–æ—Å–∫–æ–ø")],
        [types.KeyboardButton(text="üìä –ù–∞—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞")],
        [types.KeyboardButton(text="üî¢ –ß–∏—Å–ª–æ –∂–∏–∑–Ω–∏")],
        [types.KeyboardButton(text="üì® –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –≥–æ—Ä–æ—Å–∫–æ–ø"), types.KeyboardButton(text="‚ùå –û—Ç–ø–∏—Å–∞—Ç—å—Å—è")],
        [types.KeyboardButton(text="üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å")],
        [types.KeyboardButton(text="‚ùì –ü–æ–º–æ—â—å")]
    ]
    return types.ReplyKeyboardMarkup(keyboard=keyboard, resize_keyboard=True)

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —á–∏—Å–ª–∞ –∂–∏–∑–Ω–∏ (—Ñ–æ—Ä–º—É–ª—ã –¥—É—à–∏)
def calculate_soul_formula(birth_date_str: str) -> str:
    """
    –í—ã—á–∏—Å–ª—è–µ—Ç –ß–∏—Å–ª–æ –∂–∏–∑–Ω–∏ –ø–æ –¥–∞—Ç–µ —Ä–æ–∂–¥–µ–Ω–∏—è.
    Args:
        birth_date_str (str): –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì.
    Returns:
        str: –ß–∏—Å–ª–æ –∂–∏–∑–Ω–∏ (–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ–µ —á–∏—Å–ª–æ –∏–ª–∏ –º–∞—Å—Ç–µ—Ä-—á–∏—Å–ª–æ).
    """
    if not birth_date_str:
        return "–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω–∞."

    try:
        # –†–∞–∑–¥–µ–ª—è–µ–º –¥–∞—Ç—É –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç
        parts = birth_date_str.split('.')
        if len(parts) != 3:
            return "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã."

        day, month, year = map(int, parts)

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ (—É–ø—Ä–æ—â—ë–Ω–Ω–∞—è)
        if not (1 <= day <= 31) or not (1 <= month <= 12) or not (1900 <= year <= 2030):
            return "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–∞—Ç–∞."

        # –°—É–º–º–∏—Ä—É–µ–º –≤—Å–µ —Ü–∏—Ñ—Ä—ã
        total = day + month + year
        # –ü—Ä–∏–≤–æ–¥–∏–º –∫ –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ–º—É —á–∏—Å–ª—É
        while total > 9:
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –º–∞—Å—Ç–µ—Ä-—á–∏—Å–ª–∞
            if total in [11, 22, 33]:
                break
            total = sum(int(digit) for digit in str(total))

        return str(total)
    except Exception as e:
        logging.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–∏ —á–∏—Å–ª–∞ –∂–∏–∑–Ω–∏ –¥–ª—è {birth_date_str}: {e}")
        return "–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á—ë—Ç–µ."

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
def get_start_keyboard():
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞"""
    keyboard = [
        [types.KeyboardButton(text="‚ùì –ü–æ–º–æ—â—å")]
    ]
    return types.ReplyKeyboardMarkup(keyboard=keyboard, resize_keyboard=True)

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞
async def set_bot_commands(bot: Bot):
    """–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞, –≤–∏–¥–∏–º—ã–π –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ Telegram."""
    commands = [
        types.BotCommand(command="start", description="–ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º"),
        types.BotCommand(command="help", description="–ü–æ–ª—É—á–∏—Ç—å —Å–ø—Ä–∞–≤–∫—É –æ –∫–æ–º–∞–Ω–¥–∞—Ö –∏ —Ñ—É–Ω–∫—Ü–∏—è—Ö –±–æ—Ç–∞"),
    ]
    await bot.set_my_commands(commands)

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
@dp.message(CommandStart())
async def cmd_start(message: types.Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start - —É–¥–∞–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ"""
    # –ü—ã—Ç–∞–µ–º—Å—è —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–æ–º–∞–Ω–¥–æ–π
    try:
        await message.delete()
        command_deleted = True
    except Exception as e:
        logging.warning(f"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ /start: {e}")
        command_deleted = False

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    await save_user(message.from_user.id)
    # –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    await state.clear()
    
    # –¢–µ–∫—Å—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
    welcome_text = """
üîÆ –ü—Ä–∏–≤–µ—Ç! –Ø –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –±–æ—Ç!

–Ø –º–æ–≥—É:
‚Ä¢ –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–∞—à –∑–Ω–∞–∫ –∑–æ–¥–∏–∞–∫–∞
‚Ä¢ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—Ç–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç—É
‚Ä¢ –ü—Ä–∏—Å—ã–ª–∞—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –≥–æ—Ä–æ—Å–∫–æ–ø
‚Ä¢ –î–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑

–í–≤–µ–¥–∏—Ç–µ –≤–∞—à—É –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì
–ù–∞–ø—Ä–∏–º–µ—Ä: 31.07.1990
"""
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ–º
    await message.bot.send_message(
        chat_id=message.chat.id,
        text=welcome_text,
        reply_markup=get_start_keyboard()
    )

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞—Ç—ã
def validate_date_format(date_str: str) -> tuple[bool, str]:
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞—Ç—ã"""
    if not date_str or not isinstance(date_str, str):
        return False, "–î–∞—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–æ–π"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –î–î.–ú–ú.–ì–ì–ì–ì
    if not re.match(r'^\d{1,2}\.\d{1,2}\.\d{4}$', date_str):
        return False, "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì (–Ω–∞–ø—Ä–∏–º–µ—Ä: 31.07.1990)"
    
    try:
        parts = date_str.split('.')
        day, month, year = map(int, parts)
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤
        if not (1 <= day <= 31):
            return False, f"–î–µ–Ω—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 1 –¥–æ 31 (–≤—ã –≤–≤–µ–ª–∏: {day})"
        if not (1 <= month <= 12):
            return False, f"–ú–µ—Å—è—Ü –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 1 –¥–æ 12 (–≤—ã –≤–≤–µ–ª–∏: {month})"
        if not (1900 <= year <= 2030):
            return False, f"–ì–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 1900 –¥–æ 2030 (–≤—ã –≤–≤–µ–ª–∏: {year})"
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –¥–∞—Ç—ã
        if month in [4, 6, 9, 11] and day > 30:
            return False, f"–í —ç—Ç–æ–º –º–µ—Å—è—Ü–µ —Ç–æ–ª—å–∫–æ 30 –¥–Ω–µ–π"
        if month == 2:
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏—Å–æ–∫–æ—Å–Ω–æ–≥–æ –≥–æ–¥–∞
            is_leap = year % 4 == 0 and (year % 100 != 0 or year % 400 == 0)
            max_feb_days = 29 if is_leap else 28
            if day > max_feb_days:
                return False, f"–í —Ñ–µ–≤—Ä–∞–ª–µ {year} –≥–æ–¥–∞ —Ç–æ–ª—å–∫–æ {max_feb_days} –¥–Ω–µ–π"
        
        return True, ""
    except ValueError:
        return False, "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —á–∏—Å–µ–ª –≤ –¥–∞—Ç–µ"

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏
def validate_time_format(time_str: str) -> tuple[bool, str]:
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏"""
    if not time_str or not isinstance(time_str, str):
        return False, "–í—Ä–µ–º—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º"
    
    if time_str == '-':
        return True, ""
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –ß–ß:–ú–ú
    if not re.match(r'^\d{1,2}:\d{2}$', time_str):
        return False, "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ß–ß:–ú–ú (–Ω–∞–ø—Ä–∏–º–µ—Ä: 14:30) –∏–ª–∏ '-' –µ—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—Ç–µ"
    
    try:
        parts = time_str.split(':')
        hour, minute = map(int, parts)
        
        if not (0 <= hour <= 23):
            return False, f"–ß–∞—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 0 –¥–æ 23 (–≤—ã –≤–≤–µ–ª–∏: {hour})"
        if not (0 <= minute <= 59):
            return False, f"–ú–∏–Ω—É—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç 0 –¥–æ 59 (–≤—ã –≤–≤–µ–ª–∏: {minute})"
        
        return True, ""
    except ValueError:
        return False, "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —á–∏—Å–µ–ª –≤–æ –≤—Ä–µ–º–µ–Ω–∏"

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–≤–æ–¥–∞ –¥–∞—Ç—ã —Ä–æ–∂–¥–µ–Ω–∏—è
@dp.message(lambda message: message.text and '.' in message.text and len(message.text.split('.')) == 3)
async def get_birth_date(message: types.Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ –¥–∞—Ç—ã —Ä–æ–∂–¥–µ–Ω–∏—è - —É–¥–∞–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ"""
    # –ü—ã—Ç–∞–µ–º—Å—è —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    try:
        await message.delete()
    except Exception as e:
        logging.warning(f"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –¥–∞—Ç–æ–π: {e}")

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ–∂–∏–¥–∞–µ–º –ª–∏ –º—ã –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è
    current_state = await state.get_state()
    if current_state is not None and current_state != UserData.waiting_for_birth_date.state:
        # –ï—Å–ª–∏ –º—ã –≤ –¥—Ä—É–≥–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏, –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ
        # (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ª—É—á–∞–π–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏–ª –¥–∞—Ç—É –ø–æ–∑–∂–µ)
        # –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —É–∂–µ —É–¥–∞–ª–µ–Ω–æ, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
        return
    
    date_str = message.text.strip()
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞—Ç—ã
    is_valid, error_message = validate_date_format(date_str)
    if not is_valid:
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –≤ —á–∞—Ç
        await message.bot.send_message(
            chat_id=message.chat.id,
            text=f"‚ùå –û—à–∏–±–∫–∞: {error_message}\n\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì\n–ü—Ä–∏–º–µ—Ä: 31.07.1990"
        )
        return
    
    try:
        parts = date_str.split('.')
        day, month, year = map(int, parts)
        
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –¥–∞—Ç—ã
        import datetime
        try:
            datetime.date(year, month, day)
        except ValueError as e:
            await message.bot.send_message(
                chat_id=message.chat.id,
                text=f"‚ùå –û—à–∏–±–∫–∞: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–∞—Ç–∞ ({str(e)})\n\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –¥–∞—Ç—É"
            )
            return
        
        zodiac = get_zodiac_sign(day, month)
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è –∏ –∑–Ω–∞–∫ –∑–æ–¥–∏–∞–∫–∞ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
        await state.update_data(birth_date=date_str, zodiac_sign=zodiac)
        
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ —Ä–æ–∂–¥–µ–Ω–∏—è
        await state.set_state(UserData.waiting_for_birth_time)
        
        await message.bot.send_message(
            chat_id=message.chat.id,
            text=f"‚úÖ –î–∞—Ç–∞ –ø—Ä–∏–Ω—è—Ç–∞!\n–í–∞—à –∑–Ω–∞–∫ –∑–æ–¥–∏–∞–∫–∞: {zodiac} ‚ô¢\n\n"
                 f"–í–≤–µ–¥–∏—Ç–µ –≤—Ä–µ–º—è —Ä–æ–∂–¥–µ–Ω–∏—è (—Ñ–æ—Ä–º–∞—Ç –ß–ß:–ú–ú) –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ '-' –µ—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—Ç–µ:",
            reply_markup=types.ReplyKeyboardRemove()
        )
        
    except Exception as e:
        await message.bot.send_message(
            chat_id=message.chat.id,
            text=f"‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –¥–∞—Ç—ã: {str(e)}\n\n"
                 f"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì\n–ü—Ä–∏–º–µ—Ä: 31.07.1990"
        )

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–≤–æ–¥–∞ –≤—Ä–µ–º–µ–Ω–∏ —Ä–æ–∂–¥–µ–Ω–∏—è
@dp.message(UserData.waiting_for_birth_time)
async def get_birth_time(message: types.Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ –≤—Ä–µ–º–µ–Ω–∏ —Ä–æ–∂–¥–µ–Ω–∏—è - —É–¥–∞–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ"""
    # –ü—ã—Ç–∞–µ–º—Å—è —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    try:
        await message.delete()
    except Exception as e:
        logging.warning(f"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –≤—Ä–µ–º–µ–Ω–µ–º: {e}")

    time_str = message.text.strip()
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏
    is_valid, error_message = validate_time_format(time_str)
    if not is_valid:
        await message.bot.send_message(
            chat_id=message.chat.id,
            text=f"‚ùå –û—à–∏–±–∫–∞: {error_message}\n\n–í–≤–µ–¥–∏—Ç–µ –≤—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –ß–ß:–ú–ú –∏–ª–∏ '-' –µ—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—Ç–µ"
        )
        return
    
    birth_time = None
    if time_str != '-':
        birth_time = time_str
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º—è —Ä–æ–∂–¥–µ–Ω–∏—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
    await state.update_data(birth_time=birth_time)
    
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è –º–µ—Å—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è
    await state.set_state(UserData.waiting_for_birth_place)
    
    await message.bot.send_message(
        chat_id=message.chat.id,
        text="–í–≤–µ–¥–∏—Ç–µ –º–µ—Å—Ç–æ —Ä–æ–∂–¥–µ–Ω–∏—è (–≥–æ—Ä–æ–¥) –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ '-':",
        reply_markup=types.ReplyKeyboardRemove()
    )

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–≤–æ–¥–∞ –º–µ—Å—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è
@dp.message(UserData.waiting_for_birth_place)
async def get_birth_place(message: types.Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ –º–µ—Å—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è - —É–¥–∞–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ"""
    # –ü—ã—Ç–∞–µ–º—Å—è —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    try:
        await message.delete()
    except Exception as e:
        logging.warning(f"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –º–µ—Å—Ç–æ–º: {e}")

    birth_place = None
    place_text = message.text.strip()
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ–π –≤–≤–æ–¥
    if not place_text:
        await message.bot.send_message(
            chat_id=message.chat.id,
            text="‚ùå –ú–µ—Å—Ç–æ —Ä–æ–∂–¥–µ–Ω–∏—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º. –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ '-'"
        )
        return
    
    if place_text != '-':
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã
        if not re.match(r'^[–∞-—è–ê-–Øa-zA-Z\s\-,\.\d]+$', place_text):
            await message.bot.send_message(
                chat_id=message.chat.id,
                text="‚ùå –ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –≥–æ—Ä–æ–¥–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±—É–∫–≤—ã, –ø—Ä–æ–±–µ–ª—ã –∏ –¥–µ—Ñ–∏—Å—ã"
            )
            return
        birth_place = place_text
    
    # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    user_data = await state.get_data()
    birth_date = user_data['birth_date']
    zodiac_sign = user_data['zodiac_sign']
    birth_time = user_data.get('birth_time')
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    await update_user_data(
        message.from_user.id, 
        birth_date, 
        zodiac_sign, 
        birth_time, 
        birth_place
    )
    
    # –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    await state.clear()
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
    await message.bot.send_message(
        chat_id=message.chat.id,
        text="‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!",
        reply_markup=get_main_keyboard()
    )
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏
    welcome_msg = f"""
üîÆ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–µ–Ω—é –∞—Å—Ç—Ä–æ–ª–æ–≥–∞!

–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å:
üéÇ –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è: {birth_date}
‚≠ê –ó–Ω–∞–∫ –∑–æ–¥–∏–∞–∫–∞: {zodiac_sign}
"""
    if birth_time:
        welcome_msg += f"‚è∞ –í—Ä–µ–º—è —Ä–æ–∂–¥–µ–Ω–∏—è: {birth_time}\n"
    if birth_place:
        welcome_msg += f"üìç –ú–µ—Å—Ç–æ —Ä–æ–∂–¥–µ–Ω–∏—è: {birth_place}\n"
    
    welcome_msg += "\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏:"
    await message.bot.send_message(
        chat_id=message.chat.id,
        text=welcome_msg
    )

# --- –•–≠–ù–î–õ–ï–†–´ –î–õ–Ø –ö–ù–û–ü–û–ö –ò –ö–û–ú–ê–ù–î ---
# –û–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –¥–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ —Ö—ç–Ω–¥–ª–µ—Ä–∞, —á—Ç–æ–±—ã —Å—Ä–∞–±–æ—Ç–∞—Ç—å –ø–µ—Ä–≤—ã–º–∏

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help
@dp.message(Command("help"))
async def cmd_help(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help - —É–¥–∞–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–º–æ—â—å"""
    # –ü—ã—Ç–∞–µ–º—Å—è —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–æ–º–∞–Ω–¥–æ–π
    try:
        await message.delete()
    except Exception as e:
        logging.warning(f"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ /help: {e}")

    help_text = """
üîÆ –ü–æ–º–æ—â—å –ø–æ –±–æ—Ç—É:

–î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã –≤–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì
–ü—Ä–∏–º–µ—Ä: 31.07.1990

–ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é:
üîÆ –ì–æ—Ä–æ—Å–∫–æ–ø - –ü–æ–ª—É—á–∏—Ç—å –≥–æ—Ä–æ—Å–∫–æ–ø –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
üìä –ù–∞—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ - –°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∞—à—É –Ω–∞—Ç–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç—É
üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å - –ü—Ä–æ—Å–º–æ—Ç—Ä –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
üì® –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è - –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ –≥–æ—Ä–æ—Å–∫–æ–ø–∞
‚ùå –û—Ç–ø–∏—Å–∞—Ç—å—Å—è - –û—Ç–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
‚ùì –ü–æ–º–æ—â—å - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç–æ–π –±–æ—Ç–∞, –ø—Ä–æ—à—É —Å–æ–æ–±—â–∞—Ç—å @Bossofgyms

–¢–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–Ω—ã –∫–æ–º–∞–Ω–¥—ã:
/start - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º
/help - –ü–æ–º–æ—â—å
"""
    await message.bot.send_message(
        chat_id=message.chat.id,
        text=help_text,
        reply_markup=get_main_keyboard()
    )

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ 'üîÆ –ì–æ—Ä–æ—Å–∫–æ–ø'
@dp.message(lambda message: message.text == "üîÆ –ì–æ—Ä–æ—Å–∫–æ–ø")
async def btn_horoscope(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ 'üîÆ –ì–æ—Ä–æ—Å–∫–æ–ø' - —É–¥–∞–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≥–æ—Ä–æ—Å–∫–æ–ø"""
    # –ü—ã—Ç–∞–µ–º—Å—è —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π
    try:
        await message.delete()
    except Exception as e:
        logging.warning(f"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π –ì–æ—Ä–æ—Å–∫–æ–ø: {e}")

    # 1. –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î
    user_data_from_db = await get_user_data(message.from_user.id)
    if not user_data_from_db or not user_data_from_db[1]: # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∑–Ω–∞–∫–∞ –∑–æ–¥–∏–∞–∫–∞
        await message.bot.send_message(
            chat_id=message.chat.id,
            text="‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è —á–µ—Ä–µ–∑ /start"
        )
        return

    # 2. –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ
    birth_date_str = user_data_from_db[0]  # –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è (—Å—Ç—Ä–æ–∫–∞)
    zodiac_sign = user_data_from_db[1]     # –ó–Ω–∞–∫ –∑–æ–¥–∏–∞–∫–∞ (—Å—Ç—Ä–æ–∫–∞)

    # 3. –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–Ω—è –∏ –º–µ—Å—è—Ü–∞ —Ä–æ–∂–¥–µ–Ω–∏—è
    birth_day_int = None
    birth_month_int = None
    if birth_date_str:
        try:
            day, month, year = map(int, birth_date_str.split('.'))
            birth_day_int = day
            birth_month_int = month
        except (ValueError, IndexError):
            logging.warning(f"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è '{birth_date_str}' –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {message.from_user.id}")
            # birth_day_int –∏ birth_month_int –æ—Å—Ç–∞–Ω—É—Ç—Å—è None

    # 4. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≥—Ä—É–∑–∫–µ –∏ –≤—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –≥–æ—Ä–æ—Å–∫–æ–ø–∞
    # loading_msg = await message.answer("üîÆ –ü–æ–ª—É—á–∞—é –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –≥–æ—Ä–æ—Å–∫–æ–ø...")
    loading_msg = await message.bot.send_message(
        chat_id=message.chat.id,
        text="üîÆ –ü–æ–ª—É—á–∞—é –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –≥–æ—Ä–æ—Å–∫–æ–ø..."
    )
    
    # 5. –ü–µ—Ä–µ–¥–∞–µ–º –¥–µ–Ω—å –∏ –º–µ—Å—è—Ü —Ä–æ–∂–¥–µ–Ω–∏—è –≤ —Ñ—É–Ω–∫—Ü–∏—é
    horoscope_data = await get_daily_horoscope(zodiac_sign, birth_day_int, birth_month_int)
    
    await loading_msg.delete()
    
    message_text = format_real_horoscope_message(horoscope_data)
    await message.bot.send_message(
        chat_id=message.chat.id,
        text=message_text,
        reply_markup=get_main_keyboard()
    )

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ 'üìä –ù–∞—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞'
@dp.message(lambda message: message.text == "üìä –ù–∞—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞")
async def btn_natal_chart(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ 'üìä –ù–∞—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞' - —É–¥–∞–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç—É"""
    # –ü—ã—Ç–∞–µ–º—Å—è —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π
    try:
        await message.delete()
    except Exception as e:
        logging.warning(f"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π –ù–∞—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞: {e}")

    # 1. –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î
    user_data = await get_user_data(message.from_user.id)
    if not user_data or not user_data[0]:  # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∞—Ç—ã —Ä–æ–∂–¥–µ–Ω–∏—è
        await message.bot.send_message(
            chat_id=message.chat.id,
            text="‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è —á–µ—Ä–µ–∑ /start"
        )
        return
    
    # 2. –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    birth_date, zodiac_sign, birth_time, birth_place = user_data
    
    # 3. –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–∞—Ç–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç–µ 
    # –¢–µ–ø–µ—Ä—å get_natal_chart_info –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç dict —Å –∫–ª—é—á–∞–º–∏ 'info_text' –∏ 'url'
    natal_data = await get_natal_chart_info(birth_date, birth_time, birth_place)
    
    # 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –≤–æ–∑–Ω–∏–∫–ª–∞ –ª–∏ –æ—à–∏–±–∫–∞ –≤–Ω—É—Ç—Ä–∏ get_natal_chart_info
    if isinstance(natal_data, dict) and "error" in natal_data:
        await message.bot.send_message(
            chat_id=message.chat.id,
            text=natal_data["error"]
        )
        return

    # 5. –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –∏ URL –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    if isinstance(natal_data, dict) and "info_text" in natal_data and "url" in natal_data:
        info_text = natal_data["info_text"]
        chart_url = natal_data["url"]
    else:
        # –ù–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –ø–æ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–∏—á–∏–Ω–µ –≤—Å—ë –µ—â—ë –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É
        await message.bot.send_message(
            chat_id=message.chat.id,
            text="‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Ç–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç—ã."
        )
        return

    # 6. –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞
    response = f"üìä –ù–∞—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ –¥–ª—è {zodiac_sign}\n\n"
    response += info_text # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç

    # 7. –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É —Å —Å—Å—ã–ª–∫–æ–π –Ω–∞ –Ω–∞—Ç–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç—É
    button = InlineKeyboardButton(text="üîÆ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –Ω–∞—Ç–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç—É", url=chart_url)
    keyboard = InlineKeyboardMarkup(inline_keyboard=[[button]])

    # 8. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ç–µ–∫—Å—Ç–æ–º –∏ –∫–Ω–æ–ø–∫–æ–π
    await message.bot.send_message(
        chat_id=message.chat.id,
        text=response, 
        reply_markup=keyboard, # –ü—Ä–∏–∫—Ä–µ–ø–ª—è–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–æ–π
        disable_web_page_preview=True # –û—Ç–∫–ª—é—á–∞–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å—Å—ã–ª–∫–∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ç–µ–∫—Å—Ç–µ
    )

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ 'üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å'
@dp.message(lambda message: message.text == "üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å")
async def btn_profile(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ 'üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å' - —É–¥–∞–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å"""
    # –ü—ã—Ç–∞–µ–º—Å—è —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π
    try:
        await message.delete()
    except Exception as e:
        logging.warning(f"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å: {e}")

    user_data = await get_user_data(message.from_user.id)
    if not user_data or not user_data[0]:
        await message.bot.send_message(
            chat_id=message.chat.id,
            text="‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è —á–µ—Ä–µ–∑ /start"
        )
        return
    
    birth_date, zodiac_sign, birth_time, birth_place = user_data
    
    if not birth_date:
        await message.bot.send_message(
            chat_id=message.chat.id,
            text="‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è —á–µ—Ä–µ–∑ /start"
        )
        return
    
    response = f"üë§ –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å:\n\n"
    response += f"üéÇ –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è: {birth_date}\n"
    response += f"‚≠ê –ó–Ω–∞–∫ –∑–æ–¥–∏–∞–∫–∞: {zodiac_sign or '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'}\n"
    if birth_time:
        response += f"‚è∞ –í—Ä–µ–º—è —Ä–æ–∂–¥–µ–Ω–∏—è: {birth_time}\n"
    if birth_place:
        response += f"üìç –ú–µ—Å—Ç–æ —Ä–æ–∂–¥–µ–Ω–∏—è: {birth_place}\n"
    
    await message.bot.send_message(
        chat_id=message.chat.id,
        text=response,
        reply_markup=get_main_keyboard()
    )

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ 'üì® –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –≥–æ—Ä–æ—Å–∫–æ–ø'
@dp.message(lambda message: message.text == "üì® –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –≥–æ—Ä–æ—Å–∫–æ–ø")
async def btn_subscribe(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ 'üì® –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è' - —É–¥–∞–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç"""
    # –ü—ã—Ç–∞–µ–º—Å—è —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π
    try:
        await message.delete()
    except Exception as e:
        logging.warning(f"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è: {e}")

    user_data = await get_user_data(message.from_user.id)
    if not user_data or not user_data[1]:
        await message.bot.send_message(
            chat_id=message.chat.id,
            text="‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è —á–µ—Ä–µ–∑ /start"
        )
        return
    
    await subscribe_user(message.from_user.id)
    await message.bot.send_message(
        chat_id=message.chat.id,
        text="‚úÖ –í—ã —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é —Ä–∞—Å—Å—ã–ª–∫—É –≥–æ—Ä–æ—Å–∫–æ–ø–∞!\n–ì–æ—Ä–æ—Å–∫–æ–ø –±—É–¥–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 9:00 —É—Ç—Ä–∞.",
        reply_markup=get_main_keyboard()
    )

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ '‚ùå –û—Ç–ø–∏—Å–∞—Ç—å—Å—è'
@dp.message(lambda message: message.text == "‚ùå –û—Ç–ø–∏—Å–∞—Ç—å—Å—è")
async def btn_unsubscribe(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ '‚ùå –û—Ç–ø–∏—Å–∞—Ç—å—Å—è' - —É–¥–∞–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –æ—Ç–ø–∏—Å—ã–≤–∞–µ—Ç"""
    # –ü—ã—Ç–∞–µ–º—Å—è —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π
    try:
        await message.delete()
    except Exception as e:
        logging.warning(f"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π –û—Ç–ø–∏—Å–∞—Ç—å—Å—è: {e}")

    await unsubscribe_user(message.from_user.id)
    await message.bot.send_message(
        chat_id=message.chat.id,
        text="‚ùå –í—ã –æ—Ç–ø–∏—Å–∞–ª–∏—Å—å –æ—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏ –≥–æ—Ä–æ—Å–∫–æ–ø–∞.",
        reply_markup=get_main_keyboard()
    )

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ '‚ùì –ü–æ–º–æ—â—å'
@dp.message(lambda message: message.text == "‚ùì –ü–æ–º–æ—â—å")
async def btn_help(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ '‚ùì –ü–æ–º–æ—â—å' - —É–¥–∞–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–º–æ—â—å"""
    # –ü—ã—Ç–∞–µ–º—Å—è —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π
    try:
        await message.delete()
    except Exception as e:
        logging.warning(f"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π –ü–æ–º–æ—â—å: {e}")

    help_text = """
üîÆ –ü–æ–º–æ—â—å –ø–æ –±–æ—Ç—É:

–î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã –≤–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì
–ü—Ä–∏–º–µ—Ä: 31.07.1990

–ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é:
üîÆ –ì–æ—Ä–æ—Å–∫–æ–ø - –ü–æ–ª—É—á–∏—Ç—å –≥–æ—Ä–æ—Å–∫–æ–ø –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
üìä –ù–∞—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ - –°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∞—à—É –Ω–∞—Ç–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç—É
üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å - –ü—Ä–æ—Å–º–æ—Ç—Ä –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
üì® –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è - –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ –≥–æ—Ä–æ—Å–∫–æ–ø–∞
‚ùå –û—Ç–ø–∏—Å–∞—Ç—å—Å—è - –û—Ç–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
‚ùì –ü–æ–º–æ—â—å - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç–æ–π –±–æ—Ç–∞, –ø—Ä–æ—à—É —Å–æ–æ–±—â–∞—Ç—å @Bossofgyms

–¢–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–Ω—ã –∫–æ–º–∞–Ω–¥—ã:
/start - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º
/help - –ü–æ–º–æ—â—å
"""
    await message.bot.send_message(
        chat_id=message.chat.id,
        text=help_text,
        reply_markup=get_main_keyboard()
    )

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "üî¢ –ß–∏—Å–ª–æ –∂–∏–∑–Ω–∏"
@dp.message(lambda message: message.text == "üî¢ –ß–∏—Å–ª–æ –∂–∏–∑–Ω–∏")
async def btn_soul_formula(message: types.Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ 'üî¢ –ß–∏—Å–ª–æ –∂–∏–∑–Ω–∏' - —É–¥–∞–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç"""
    # –ü—ã—Ç–∞–µ–º—Å—è —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π
    try:
        await message.delete()
    except Exception as e:
        logging.warning(f"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π –ß–∏—Å–ª–æ –∂–∏–∑–Ω–∏: {e}")

    # 1. –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î
    user_data = await get_user_data(message.from_user.id)
    if not user_data or not user_data[0]:  # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∞—Ç—ã —Ä–æ–∂–¥–µ–Ω–∏—è
        await message.bot.send_message(
            chat_id=message.chat.id,
            text="‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è —á–µ—Ä–µ–∑ /start",
            reply_markup=get_main_keyboard() # –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
        )
        return

    # 2. –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è
    birth_date = user_data[0]

    # 3. –í—ã—á–∏—Å–ª—è–µ–º —Ñ–æ—Ä–º—É–ª—É –¥—É—à–∏
    soul_number = calculate_soul_formula(birth_date)

    # 4. –§–æ—Ä–º–∏—Ä—É–µ–º –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç
    # --- –û–±–Ω–æ–≤–ª—è–µ–º –æ–ø–∏—Å–∞–Ω–∏—è —Å –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π ---
    descriptions = {
        "1": (
            "–ï–¥–∏–Ω–∏—Ü–∞ —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä—É–µ—Ç –Ω–æ–≤–æ–µ –Ω–∞—á–∞–ª–æ, –ª–∏–¥–µ—Ä—Å—Ç–≤–æ, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –∏ —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –±—ã—Ç—å –ø–µ—Ä–≤—ã–º. "
            "–í—ã –æ–±–ª–∞–¥–∞–µ—Ç–µ —Å–∏–ª—å–Ω–æ–π –≤–æ–ª–µ–π, –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–æ–π –∏ –∞–º–±–∏—Ü–∏—è–º–∏. –õ—é–¥–∏ —Å —ç—Ç–∏–º —á–∏—Å–ª–æ–º —á–∞—Å—Ç–æ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –≤–¥–æ—Ö–Ω–æ–≤–∏—Ç–µ–ª—è–º–∏ –∏ –Ω–æ–≤–∞—Ç–æ—Ä–∞–º–∏. "
            "–í–∞—à–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: —Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, —Ç–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥, —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è. "
            "–í–æ–∑–º–æ–∂–Ω—ã–µ —Å–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: –∏–º–ø—É–ª—å—Å–∏–≤–Ω–æ—Å—Ç—å, –Ω–µ—Ç–µ—Ä–ø–µ–Ω–∏–µ, —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å, –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª–∏–∑–º."
        ),
        "2": (
            "–î–≤–æ–π–∫–∞ –æ–ª–∏—Ü–µ—Ç–≤–æ—Ä—è–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ, –¥–∏–ø–ª–æ–º–∞—Ç–∏—é, —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ –≥–∞—Ä–º–æ–Ω–∏–∏. "
            "–í—ã —Ü–µ–Ω–∏—Ç–µ –ø–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è, —É–º–µ–µ—Ç–µ —Å–ª—É—à–∞—Ç—å –∏ —á—É–≤—Å—Ç–≤—É–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –æ–∫—Ä—É–∂–∞—é—â–∏—Ö. "
            "–í–∞—à–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: —ç–º–ø–∞—Ç–∏—è, –¥–∏–ø–ª–æ–º–∞—Ç–∏—á–Ω–æ—Å—Ç—å, —É–º–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –∫–æ–º–∞–Ω–¥–µ, –≥–∏–±–∫–æ—Å—Ç—å. "
            "–í–æ–∑–º–æ–∂–Ω—ã–µ —Å–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: –∏–∑–ª–∏—à–Ω—è—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –º–Ω–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö, –Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –∏–∑–±–µ–≥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤, —á—Ä–µ–∑–º–µ—Ä–Ω–∞—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å."
        ),
        "3": (
            "–¢—Ä–æ–π–∫–∞ —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ, —Å–∞–º–æ–≤—ã—Ä–∞–∂–µ–Ω–∏–µ, –æ–±—â–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–º. "
            "–í—ã –ª–µ–≥–∫–æ –Ω–∞—Ö–æ–¥–∏—Ç–µ –æ–±—â–∏–π —è–∑—ã–∫ —Å –ª—é–¥—å–º–∏, –ª—é–±–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ –∏ —É–º–µ–µ—Ç–µ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—Ç—å. "
            "–í–∞—à–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: –∫–æ–º–º—É–Ω–∏–∫–∞–±–µ–ª—å–Ω–æ—Å—Ç—å, —Ç–≤–æ—Ä—á–µ—Å–∫–∏–π —Ç–∞–ª–∞–Ω—Ç, –∂–∏–∑–Ω–µ—Ä–∞–¥–æ—Å—Ç–Ω–æ—Å—Ç—å, –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏–µ. "
            "–í–æ–∑–º–æ–∂–Ω—ã–µ —Å–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω–æ—Å—Ç—å, —Ä–∞—Å—Å–µ—è–Ω–Ω–æ—Å—Ç—å, –∏–∑–ª–∏—à–Ω—è—è –±–æ–ª—Ç–ª–∏–≤–æ—Å—Ç—å, —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ —Å –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–µ–π."
        ),
        "4": (
            "–ß–µ—Ç–≤–µ—Ä–∫–∞ –æ–∑–Ω–∞—á–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å, –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∏ —Ç—Ä—É–¥–æ–ª—é–±–∏–µ. "
            "–í—ã —Ü–µ–Ω–∏—Ç–µ –ø–æ—Ä—è–¥–æ–∫, –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏ —Å–ø–æ—Å–æ–±–Ω—ã –¥–æ–≤–æ–¥–∏—Ç—å –Ω–∞—á–∞—Ç–æ–µ –¥–æ –∫–æ–Ω—Ü–∞. "
            "–í–∞—à–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞, –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å, –ª–æ–≥–∏—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ, —Ç–µ—Ä–ø–µ–Ω–∏–µ. "
            "–í–æ–∑–º–æ–∂–Ω—ã–µ —Å–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: —É–ø—Ä—è–º—Å—Ç–≤–æ, —Å–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∫ —Ä—É—Ç–∏–Ω–µ, –∏–∑–ª–∏—à–Ω–∏–π –ø–µ—Å—Å–∏–º–∏–∑–º, —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–∞–º."
        ),
        "5": (
            "–ü—è—Ç–µ—Ä–∫–∞ —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä—É–µ—Ç —Å–≤–æ–±–æ–¥—É, –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è, –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –ª—é–±–æ–ø—ã—Ç—Å—Ç–≤–æ. "
            "–í—ã –ª—é–±–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω—ã, –Ω–æ–≤—ã–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è –∏ –Ω–µ –±–æ–∏—Ç–µ—Å—å —Ä–∏—Å–∫–∞. "
            "–í–∞—à–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å, –ª—é–±–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —ç–Ω–µ—Ä–≥–∏—á–Ω–æ—Å—Ç—å, –≥–∏–±–∫–æ—Å—Ç—å –º—ã—à–ª–µ–Ω–∏—è. "
            "–í–æ–∑–º–æ–∂–Ω—ã–µ —Å–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: –Ω–µ—É–≥–æ–º–æ–Ω–Ω–æ—Å—Ç—å, –Ω–µ–ø–æ—Å—Ç–æ—è–Ω—Å—Ç–≤–æ, —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ —Å –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞–º–∏, –∏–º–ø—É–ª—å—Å–∏–≤–Ω–æ—Å—Ç—å."
        ),
        "6": (
            "–®–µ—Å—Ç–µ—Ä–∫–∞ –æ–ª–∏—Ü–µ—Ç–≤–æ—Ä—è–µ—Ç –∑–∞–±–æ—Ç—É, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å, –≥–∞—Ä–º–æ–Ω–∏—é –∏ —á—É–≤—Å—Ç–≤–æ –¥–æ–ª–≥–∞. "
            "–í—ã —Å—Ç—Ä–µ–º–∏—Ç–µ—Å—å –∫ —Å—Ç–∞–±–∏–ª—å–Ω—ã–º –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º, –∑–∞–±–æ—Ç–∏—Ç–µ—Å—å –æ –±–ª–∏–∑–∫–∏—Ö –∏ —Ü–µ–Ω–∏—Ç–µ –∫—Ä–∞—Å–æ—Ç—É –∏ –ø–æ—Ä—è–¥–æ–∫. "
            "–í–∞—à–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: –∑–∞–±–æ—Ç–ª–∏–≤–æ—Å—Ç—å, –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å, —á—É–≤—Å—Ç–≤–æ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç–∏, –ª—é–±–æ–≤—å –∫ –∫—Ä–∞—Å–æ—Ç–µ. "
            "–í–æ–∑–º–æ–∂–Ω—ã–µ —Å–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: —á—Ä–µ–∑–º–µ—Ä–Ω–∞—è —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å, —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏—Ö, —Å–∞–º–æ–ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–µ, –æ–±–∏–¥–∞ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–µ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏."
        ),
        "7": (
            "–°–µ–º–µ—Ä–∫–∞ —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä—É–µ—Ç –∞–Ω–∞–ª–∏–∑, –∏–Ω—Ç—Ä–æ—Å–ø–µ–∫—Ü–∏—é, —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ –∑–Ω–∞–Ω–∏—è–º –∏ –ø–æ–∏—Å–∫ –∏—Å—Ç–∏–Ω—ã. "
            "–í—ã –ª—é–±–∏—Ç–µ —Ä–∞–∑–º—ã—à–ª—è—Ç—å, —É–≥–ª—É–±–ª—è—Ç—å—Å—è –≤ —Å—É—Ç—å –≤–µ—â–µ–π –∏ —Ü–µ–Ω–∏—Ç–µ —É–µ–¥–∏–Ω–µ–Ω–∏–µ. "
            "–í–∞—à–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π —É–º, –∏–Ω—Ç—É–∏—Ü–∏—è, –º—É–¥—Ä–æ—Å—Ç—å, —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ —Å–∞–º–æ–ø–æ–∑–Ω–∞–Ω–∏—é. "
            "–í–æ–∑–º–æ–∂–Ω—ã–µ —Å–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: —Å–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∫ –∏–∑–æ–ª—è—Ü–∏–∏, —á—Ä–µ–∑–º–µ—Ä–Ω—ã–π –ø–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏–∑–º, —Å–∫–µ–ø—Ç–∏—Ü–∏–∑–º, —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ —Å –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º —ç–º–æ—Ü–∏–π."
        ),
        "8": (
            "–í–æ—Å—å–º–µ—Ä–∫–∞ –æ–∑–Ω–∞—á–∞–µ—Ç –≤–ª–∞—Å—Ç—å, –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–π —É—Å–ø–µ—Ö, –∞–º–±–∏—Ü–∏–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–∏–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏. "
            "–í—ã —Å—Ç—Ä–µ–º–∏—Ç–µ—Å—å –∫ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—é —Ü–µ–ª–µ–π, –æ–±–ª–∞–¥–∞–µ—Ç–µ —Å–∏–ª—å–Ω–æ–π –≤–æ–ª–µ–π –∏ —á—É–≤—Å—Ç–≤–æ–º —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç–∏. "
            "–í–∞—à–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: —Ä–µ—à–∏–º–æ—Å—Ç—å, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä—Å–∫–∏–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏, —É–º–µ–Ω–∏–µ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å, –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–ª—å–∑–∞. "
            "–í–æ–∑–º–æ–∂–Ω—ã–µ —Å–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: —á—Ä–µ–∑–º–µ—Ä–Ω—ã–π —Ñ–æ–∫—É—Å –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–º, –∂–µ—Å—Ç–∫–æ—Å—Ç—å, —Å–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∫ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏—è–º, —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ –≤ –ª–∏—á–Ω–æ–π –∂–∏–∑–Ω–∏ –∏–∑-–∑–∞ —Ä–∞–±–æ—Ç—ã."
        ),
        "9": (
            "–î–µ–≤—è—Ç–∫–∞ —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä—É–µ—Ç –≥—É–º–∞–Ω–∏–∑–º, –∏–¥–µ–∞–ª–∏–∑–º, —Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏–µ –∏ —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ —Å–ª—É–∂–∏—Ç—å –¥—Ä—É–≥–∏–º. "
            "–í—ã —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã –∫ —Å—Ç—Ä–∞–¥–∞–Ω–∏—è–º –º–∏—Ä–∞ –∏ —Å—Ç—Ä–µ–º–∏—Ç–µ—Å—å –≤–Ω–µ—Å—Ç–∏ –≤–∫–ª–∞–¥ –≤ –æ–±—â–µ–µ –±–ª–∞–≥–æ. "
            "–í–∞—à–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: —Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏–µ, –∞–ª—å—Ç—Ä—É–∏–∑–º, —Ç–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç—å, —Ç–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª. "
            "–í–æ–∑–º–æ–∂–Ω—ã–µ —Å–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: —á—Ä–µ–∑–º–µ—Ä–Ω–∞—è —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, —Å–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∫ –∂–µ—Ä—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏, —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–∏–µ –∏–∑-–∑–∞ –Ω–µ—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–∞ –º–∏—Ä–∞, —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ —Å –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π –ª–∏—á–Ω—ã—Ö –≥—Ä–∞–Ω–∏—Ü."
        ),
        "11": (
            "–û–¥–∏–Ω–Ω–∞–¥—Ü–∞—Ç—å - –º–∞—Å—Ç–µ—Ä-—á–∏—Å–ª–æ, —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä—É—é—â–µ–µ –∏–Ω—Ç—É–∏—Ü–∏—é, –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ, –∏–¥–µ–∞–ª–∏–∑–º –∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–ª—è –¥—É—Ö–æ–≤–Ω–æ–≥–æ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è. "
            "–í—ã –æ–±–ª–∞–¥–∞–µ—Ç–µ –æ—Å—Ç—Ä—ã–º —É–º–æ–º, —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã –∫ —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫–µ –æ–∫—Ä—É–∂–∞—é—â–∏—Ö –∏ —á–∞—Å—Ç–æ –∏—Å–ø—ã—Ç—ã–≤–∞–µ—Ç–µ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ. "
            "–í–∞—à–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: –≤—ã—Å–æ–∫–∞—è –∏–Ω—Ç—É–∏—Ü–∏—è, –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–µ–µ –ª–∏–¥–µ—Ä—Å—Ç–≤–æ, –∏–¥–µ–∞–ª–∏–∑–º, —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å. "
            "–í–æ–∑–º–æ–∂–Ω—ã–µ —Å–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: —á—Ä–µ–∑–º–µ—Ä–Ω–∞—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —Å–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∫ –∏–ª–ª—é–∑–∏—è–º, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏–∑-–∑–∞ –≤—ã—Å–æ–∫–∏—Ö –∏–¥–µ–∞–ª–æ–≤, —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ —Å –∑–∞–∑–µ–º–ª–µ–Ω–∏–µ–º."
        ),
        "22": (
            "–î–≤–∞–¥—Ü–∞—Ç—å –¥–≤–∞ - –º–∞—Å—Ç–µ—Ä-—á–∏—Å–ª–æ, —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä—É—é—â–µ–µ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ –≤ –≤–æ–ø–ª–æ—â–µ–Ω–∏–∏ –≤–µ–ª–∏–∫–∏—Ö –∏–¥–µ–π, –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–π –∏–¥–µ–∞–ª–∏–∑–º –∏ —Å–∏–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –º–∏—Ä. "
            "–í—ã –æ–±–ª–∞–¥–∞–µ—Ç–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–æ–º –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º–∞—Å—à—Ç–∞–±–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ –º–æ–∂–µ—Ç–µ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—Ç—å –¥—Ä—É–≥–∏—Ö –Ω–∞ –±–æ–ª—å—à–∏–µ —Å–≤–µ—Ä—à–µ–Ω–∏—è. "
            "–í–∞—à–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—á—Ç–∞—Ç–µ–ª–∏, —Å–∏–ª—å–Ω–∞—è –≤–æ–ª—è, –ª–∏–¥–µ—Ä—Å–∫–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞, —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –≤–¥–æ—Ö–Ω–æ–≤–ª—è—Ç—å. "
            "–í–æ–∑–º–æ–∂–Ω—ã–µ —Å–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: –¥–∞–≤–ª–µ–Ω–∏–µ –≤—ã—Å–æ–∫–∏—Ö –æ–∂–∏–¥–∞–Ω–∏–π, —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ —Å –±–∞–ª–∞–Ω—Å–æ–º –º–µ–∂–¥—É –∏–¥–µ–∞–ª–∞–º–∏ –∏ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å—é, —Å–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∫ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–µ."
        ),
        "33": (
            "–¢—Ä–∏–¥—Ü–∞—Ç—å —Ç—Ä–∏ - —Ä–µ–¥–∫–æ–µ –º–∞—Å—Ç–µ—Ä-—á–∏—Å–ª–æ, —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä—É—é—â–µ–µ –≤—ã—Å—à—É—é —Å—Ç–µ–ø–µ–Ω—å —Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏—è, –º—É–¥—Ä–æ—Å—Ç–∏ –∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –±—ã—Ç—å —É—á–∏—Ç–µ–ª–µ–º –∏ —Ü–µ–ª–∏—Ç–µ–ª–µ–º. "
            "–í—ã –æ–±–ª–∞–¥–∞–µ—Ç–µ –≤–µ–ª–∏–∫–æ–¥—É—à–∏–µ–º –∏ —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ–º –ø–æ–º–æ–≥–∞—Ç—å –¥—Ä—É–≥–∏–º –Ω–∞ –≥–ª—É–±–æ–∫–æ–º —É—Ä–æ–≤–Ω–µ. "
            "–í–∞—à–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: –≤—ã—Å–æ–∫–æ–µ —Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏–µ, –º—É–¥—Ä–æ—Å—Ç—å, –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–µ–µ –Ω–∞—Å—Ç–∞–≤–Ω–∏—á–µ—Å—Ç–≤–æ, —Ü–µ–ª–∏—Ç–µ–ª—å–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è. "
            "–í–æ–∑–º–æ–∂–Ω—ã–µ —Å–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: —á—Ä–µ–∑–º–µ—Ä–Ω–∞—è –∂–µ—Ä—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å, —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º –ª–∏—á–Ω—ã—Ö –≥—Ä–∞–Ω–∏—Ü, —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –≤—ã–≥–æ—Ä–∞–Ω–∏–µ –∏–∑-–∑–∞ –∑–∞–±–æ—Ç—ã –æ –¥—Ä—É–≥–∏—Ö."
        ),
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
        "–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω–∞.": "‚ùå –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω–∞.",
        "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã.": "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã.",
        "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–∞—Ç–∞.": "‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–∞—Ç–∞.",
        "–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á—ë—Ç–µ.": "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á—ë—Ç–µ —Ñ–æ—Ä–º—É–ª—ã –¥—É—à–∏."
    }
    # --- –ö–æ–Ω–µ—Ü –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –æ–ø–∏—Å–∞–Ω–∏–π ---

    base_description = descriptions.get(soul_number, f"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —á–∏—Å–ª–æ: {soul_number}")

    # –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—É—á–Ω–æ-–æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
    disclaimer = "\n\n‚ÑπÔ∏è *–í–∞–∂–Ω–æ:* –ù—É–º–µ—Ä–æ–ª–æ–≥–∏—è –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –Ω–∞—É—á–Ω–æ–π –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–æ–π. –≠—Ç–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —á–∏—Å–µ–ª, –æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ —Ç—Ä–∞–¥–∏—Ü–∏—è—Ö –∏ –≤–µ—Ä–æ–≤–∞–Ω–∏—è—Ö."

    response = f"üî¢ –í–∞—à–µ –ß–∏—Å–ª–æ –ñ–∏–∑–Ω–∏: *{soul_number}*\n\n{base_description}{disclaimer}"

    await message.bot.send_message(
        chat_id=message.chat.id,
        text=response,
        reply_markup=get_main_keyboard(),
        parse_mode='Markdown' # –ò—Å–ø–æ–ª—å–∑—É–µ–º Markdown –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    )

# –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ô –•–≠–ù–î–õ–ï–† –î–õ–Ø –û–°–¢–ê–õ–¨–ù–´–• –°–û–û–ë–©–ï–ù–ò–ô
# –≠—Ç–æ—Ç —Ö—ç–Ω–¥–ª–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–º, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã –∏ –∫–Ω–æ–ø–∫–∏
@dp.message(~F.text.startswith("/")) # –õ–æ–≤–∏–º —Å–æ–æ–±—â–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ù–ï –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å "/"
async def handle_any_other_message(message: types.Message, state: FSMContext):
    """
    –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ª—é–±—ã—Ö –¥—Ä—É–≥–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.
    –ü—ã—Ç–∞–µ—Ç—Å—è —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç FSM-—Å–æ—Å—Ç–æ—è–Ω–∏—è.
    """
    # –ü—ã—Ç–∞–µ–º—Å—è —É–¥–∞–ª–∏—Ç—å –ª—é–±–æ–µ –≤—Ö–æ–¥—è—â–µ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–∫—Ä–æ–º–µ –∫–æ–º–∞–Ω–¥)
    try:
        await message.delete()
    except Exception as e:
        logging.warning(f"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ '{message.text}': {e}")

    current_state = await state.get_state()
    
    # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≤–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö, –Ω–æ –æ—Ç–ø—Ä–∞–≤–∏–ª —á—Ç–æ-—Ç–æ –Ω–µ —Ç–æ
    if current_state == UserData.waiting_for_birth_date.state:
        await message.bot.send_message(
            chat_id=message.chat.id,
            text="‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì\n"
                 "–ü—Ä–∏–º–µ—Ä: 31.07.1990"
        )
    elif current_state == UserData.waiting_for_birth_time.state:
        await message.bot.send_message(
            chat_id=message.chat.id,
            text="‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤—Ä–µ–º—è —Ä–æ–∂–¥–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –ß–ß:–ú–ú –∏–ª–∏ '-' –µ—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—Ç–µ\n"
                 "–ü—Ä–∏–º–µ—Ä: 14:30 –∏–ª–∏ -"
        )
    elif current_state == UserData.waiting_for_birth_place.state:
        await message.bot.send_message(
            chat_id=message.chat.id,
            text="‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –º–µ—Å—Ç–æ —Ä–æ–∂–¥–µ–Ω–∏—è (–≥–æ—Ä–æ–¥) –∏–ª–∏ '-' –µ—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—Ç–µ"
        )
    # –î–ª—è –≤—Å–µ—Ö –¥—Ä—É–≥–∏—Ö —Å–ª—É—á–∞–µ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ª—É—á–∞–π–Ω—ã–π —Ç–µ–∫—Å—Ç) –ø—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
    # –∏–ª–∏ –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–±—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ:
    # else:
    #     await message.bot.send_message(
    #         chat_id=message.chat.id,
    #         text="üîÆ –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –∏–ª–∏ –∫–æ–º–∞–Ω–¥—ã.\n/help - –ü–æ–º–æ—â—å",
    #         reply_markup=get_main_keyboard()
    #     )

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≥–æ—Ä–æ—Å–∫–æ–ø–∞
def format_real_horoscope_message(data: dict) -> str:
    """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≥–æ—Ä–æ—Å–∫–æ–ø–∞ —Å –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏"""
    message = data.get('description', '–ì–æ—Ä–æ—Å–∫–æ–ø –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.')
    return message

# –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞
async def main():
    await init_db()
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–æ—Ç–∞ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ–º–∞–Ω–¥
    bot_instance = Bot(token=BOT_TOKEN)
    
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–º–∞–Ω–¥—ã
    await set_bot_commands(bot_instance)
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
    asyncio.create_task(scheduler(bot_instance))
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º polling
    await dp.start_polling(bot_instance)

# –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –ø—Ä–æ–≥—Ä–∞–º–º—É
if __name__ == "__main__":
    asyncio.run(main())
